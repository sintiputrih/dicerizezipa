<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>How do I delete a time series from Prometheus v2, specifically a series of alerts -</title><meta name=robots content="index,follow,noarchive"><meta name=description content="We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.:
DELETE https://prometheus/api/v1/series?match[]={__name__=&#34;ALERTS&#34;}  We have recently upgraded our Prometheus server from 1.8 to 2.2.1.
Calling this endpoint now gives
{ &#34;status&#34;: &#34;error&#34;, &#34;errorType&#34;: &#34;internal&#34;, &#34;error&#34;: &#34;not implemented&#34; }  I have done some research and found a solution in various locations, which I will summarise in an answer below in case it's of use to my fellow StackOverflowers"><meta name=author content="Martina Birk"><link rel="preload stylesheet" as=style href=https://assets.cdnweb.info/hugo/paper/css/app.css><link rel="preload stylesheet" as=style href=https://assets.cdnweb.info/hugo/paper/css/an-old-hope.min.css><script defer src=https://assets.cdnweb.info/hugo/paper/js/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=./theme.png><link rel=icon href=./favicon.ico><link rel=apple-touch-icon href=./apple-touch-icon.png><meta name=generator content="Hugo 0.98.0"><meta property="og:title" content="How do I delete a time series from Prometheus v2, specifically a series of alerts"><meta property="og:description" content="We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.: We have recently upgraded our Prometheus server from 1.8 to 2.2.1."><meta property="og:type" content="article"><meta property="og:url" content="/how-do-i-delete-a-time-series-from-prometheus-v2-specifically-a-series-of-alert.html"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-03-30T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-30T00:00:00+00:00"><meta itemprop=name content="How do I delete a time series from Prometheus v2, specifically a series of alerts"><meta itemprop=description content="We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.: We have recently upgraded our Prometheus server from 1.8 to 2.2.1."><meta itemprop=datePublished content="2024-03-30T00:00:00+00:00"><meta itemprop=dateModified content="2024-03-30T00:00:00+00:00"><meta itemprop=wordCount content="237"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="How do I delete a time series from Prometheus v2, specifically a series of alerts"><meta name=twitter:description content="We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.: We have recently upgraded our Prometheus server from 1.8 to 2.2.1."></head><body class=not-ready data-menu=true><header class=header><p class=logo><a class=site-name href=./index.html>ZBlogN</a><a class=btn-dark></a></p><script>let bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>{bodyClx[e?"add":"remove"]("dark"),localStorage.setItem("dark",e?"yes":"no")};setDark(darkVal?darkVal==="yes":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",e=>setDark(e.matches))</script><nav class=menu><a href=./sitemap.xml>Sitemap</a></nav></header><main class=main><article class=post-single><header class=post-title><p><time>Mar 30, 2024</time>
<span>Martina Birk</span></p><h1>How do I delete a time series from Prometheus v2, specifically a series of alerts</h1></header><section class=post-content><img src=https://cdn.statically.io/img/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.:</p><pre><code>DELETE https://prometheus/api/v1/series?match[]={__name__="ALERTS"} </code></pre><p>We have recently upgraded our Prometheus server from 1.8 to 2.2.1.</p><p>Calling this endpoint now gives</p><pre><code>{ "status": "error", "errorType": "internal", "error": "not implemented" } </code></pre><p>I have done some research and found a solution in various locations, which I will summarise in an answer below in case it's of use to my fellow StackOverflowers</p><span class=d-none itemprop=commentCount></span><h2 class=mb0 data-answercount=2>2 Answers</h2><p>Firstly the admin API is not enabled by default in Prometheus 2. This must be made active by starting the server with the option</p><pre><code>--web.enable-admin-api </code></pre><p>There is a new endpoint in v2 at</p><pre><code>https://prometheus/api/v2/admin/tsdb/delete_series </code></pre><p>This takes a <code>POST</code> specifying the search criteria, e.g. for a time series with the name <code>ALERTS</code> where the alert name is <code>MyTestAlert</code>, post the following <code>application/json</code> to the <code>delete_series</code> endpoint, from the tool of choice (Tested with Postman 6 on Mac)</p><pre><code>{ "matchers": [{ "type": "EQ", "name": "__name__", "value": "ALERTS" }, { "type": "EQ", "name": "alertname", "value": "MyTestAlert" }] } </code></pre><p>For completeness and to free the disk space where the alerts were persisted, <code>POST</code> an empty payload to</p><pre><code>https://prometheus/api/v2/admin/tsdb/clean_tombstones </code></pre><p>Answer aggregated from:</p><ul><li><a href=# rel=noreferrer>https://prometheus.io/docs/prometheus/latest/querying/api/</a></li><li><a href=# rel=noreferrer>https://github.com/prometheus/prometheus/issues/3584</a></li><li><a href=# rel=noreferrer>https://groups.google.com/forum/#!msg/prometheus-users/ToMKsb9fYp8/az6afuX3CgAJ</a></li></ul><span class=d-none itemprop=commentCount>5</span><p>Curl variant:</p><pre><code># delete alerts series curl -g -XPOST 'http://prometheus:9090/api/v1/admin/tsdb/delete_series?match[]=ALERTS' # delete data from disk curl -XPOST http://prometheus:9090/api/v1/admin/tsdb/clean_tombstones </code></pre><span class=d-none itemprop=commentCount>1</span><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmirpJawrLvVnqmfpJ%2Bse6S7zGiorp2jqbawutJoa3JwZW6Ad3yOoaawZZSkeqp5w56jnqyVYq5uwMimnGarlae2pr%2BMn6mopV2lv7C5xK2fnq2jYsNzedKpnJyhlp6worjLsmSaZaOav6qx0mamn2WRobKzwA%3D%3D</p></section><nav class=post-nav><a class=prev href=./evan-ghang-age-wiki-biography-height-weight-net-worth.html><span>←</span><span>Evan Ghang Age, wiki, Biography, Height, Weight, Net Worth</span></a>
<a class=next href=./kristen-bell-and-dax-shepards-rare-family-photos-of-daughters.html><span>Kristen Bell and Dax Shepard's Rare Family Photos of Daughters</span><span>→</span></a></nav></article></main><footer class=footer><p>&copy; 2024 <a href=./></a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p></footer><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/banner.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>